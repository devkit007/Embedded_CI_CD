# name: GitHub Actions Demo
# run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
# on: [push]
# jobs:
#   Explore-GitHub-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
#       - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#       - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#       - name: Check out repository code
#         uses: actions/checkout@v4
#       - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
#       - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
#       - name: List files in the repository
#         run: |
#           ls ${{ github.workspace }}
#       - run: echo "üçè This job's status is ${{ job.status }}."

name: Build and Test nRF Connect SDK

on: [push]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Add nRF Connect SDK as Git Submodule
      run: git submodule add https://github.com/nrfconnect/sdk-nrf nrf_connect_sdk
      shell: bash

    - name: Set Up Environment
      run: |
        choco install ruby
        choco install qemu
        SET PATH=C:\Ruby32-x64\bin;C:\Program Files\qemu;%PATH%
        SET PATH=C:\ncs\toolchains\31f4403e35;C:\ncs\toolchains\31f4403e35\mingw64\bin;C:\ncs\toolchains\31f4403e35\bin;C:\ncs\toolchains\31f4403e35\opt\bin;C:\ncs\toolchains\31f4403e35\opt\bin\Scripts;C:\ncs\toolchains\31f4403e35\opt\nanopb\generator-bin;C:\ncs\toolchains\31f4403e35\opt\zephyr-sdk\aarch64-zephyr-elf\bin;C:\ncs\toolchains\31f4403e35\opt\zephyr-sdk\x86_64-zephyr-elf\bin;C:\ncs\toolchains\31f4403e35\opt\zephyr-sdk\arm-zephyr-eabi\bin;%PATH%
        SET PYTHONPATH=C:\ncs\toolchains\31f4403e35\opt\bin;C:\ncs\toolchains\31f4403e35\opt\bin\Lib;C:\ncs\toolchains\31f4403e35\opt\bin\Lib\site-packages
      shell: cmd

    - name: Build and Test Application
      run: |
        SET ZEPHYR_TOOLCHAIN_VARIANT=zephyr
        SET ZEPHYR_SDK_INSTALL_DIR=C:\ncs\toolchains\31f4403e35\opt\zephyr-sdk
        SET ZEPHYR_BASE=C:\ncs\v2.4.0\zephyr

        REM Set build type. qemu for virtual test. Comment out for test on the real HW device!
        set build_type=qemu

        if "%build_type%"=="qemu" (
            west build --pristine --board qemu_cortex_m3 -t run
        ) else (
            west build --pristine --board de1353_cpuapp --no-sysbuild -- -DNCS_TOOLCHAIN_VERSION:STRING="NONE" -DBOARD_ROOT:STRING="nrf_connect_sdk/boards"  # Pfade entsprechend anpassen
            nrfjprog  --recover --coprocessor CP_NETWORK
            west flash -d .\build --skip-rebuild
        )
      shell: cmd

    - name: Test Results
      run: |
        REM Add steps to check and report test results
      shell: cmd

