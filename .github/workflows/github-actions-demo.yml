name: Build and Test nRF Connect SDK

on: [push]

jobs:
  build-firmware:
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

# Installing nRF Connect SDK
# https://developer.nordicsemi.com/nRF_Connect_SDK/doc/latest/nrf/installation/installing.html

    - name: Install the required tools
      run: |
        choco feature enable -n allowGlobalConfirmation
        choco install cmake --installargs 'ADD_CMAKE_TO_PATH=System'
        choco install ninja gperf python git dtc-msys2 wget 7zip
        choco list
      shell: pwsh

    - name: Install west
      run: pip3 install west

    - name: Create 'ncs' Folder
      run: | 
        mkdir ${{ github.workspace }}/ncs
        ls
      shell: powershell

    - name: Restore nRF Connect SDK Cache
      uses: actions/cache@v2
      with:
        path: ${{ github.workspace }}/ncs
        key: ncs-${{ runner.os }}-${{ hashFiles('**/west.yml') }}
        restore-keys: |
          ncs-windows-

    - name: Get the nRF Connect SDK code
      if: steps.restore-cache.outputs.cache-hit != 'true'
      working-directory: ${{ github.workspace }}/ncs
      run: |
        west init -m https://github.com/nrfconnect/sdk-nrf --mr v2.4.0
        west init -m https://github.com/nrfconnect/sdk-nrf --mr main
        west update
        west zephyr-export
        ls

    - name: List ncs Folder
      working-directory: ${{ github.workspace }}/ncs
      run: ls



